2021-04-30 15:27:50,346 p=23860 u=root n=ansible | PLAY [Init EcoX Cluster] *******************************************************
2021-04-30 15:27:50,397 p=23860 u=root n=ansible | TASK [ecox : Node configure disable firewall] **********************************
2021-04-30 15:27:52,358 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:27:52,361 p=23860 u=root n=ansible | TASK [ecox : Node configure stop firewall] *************************************
2021-04-30 15:27:52,888 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:27:52,891 p=23860 u=root n=ansible | TASK [ecox : Create os group postgres] *****************************************
2021-04-30 15:27:53,383 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:27:53,392 p=23860 u=root n=ansible | TASK [ecox : Create dbsu postgres] *********************************************
2021-04-30 15:27:54,011 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:27:54,014 p=23860 u=root n=ansible | TASK [ecox : Fix pg home directory ownership] **********************************
2021-04-30 15:27:54,536 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:27:54,540 p=23860 u=root n=ansible | TASK [ecox : Copy PostgreSQL RPMS] *********************************************
2021-04-30 15:27:56,972 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:27:56,975 p=23860 u=root n=ansible | TASK [ecox : Install PostgreSQL RPMS] ******************************************
2021-04-30 15:27:59,491 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:27:59,496 p=23860 u=root n=ansible | TASK [ecox : Link /usr/pgsql to current version] *******************************
2021-04-30 15:27:59,894 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:27:59,897 p=23860 u=root n=ansible | TASK [ecox : Add pg bin dir to profile path] ***********************************
2021-04-30 15:28:00,570 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:00,575 p=23860 u=root n=ansible | TASK [ecox : Fix directory ownership] ******************************************
2021-04-30 15:28:00,966 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:00,970 p=23860 u=root n=ansible | TASK [ecox : Copy EcoX RPMS] ***************************************************
2021-04-30 15:28:01,917 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:01,920 p=23860 u=root n=ansible | TASK [ecox : Install EcoX RPMS] ************************************************
2021-04-30 15:28:02,475 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:02,478 p=23860 u=root n=ansible | TASK [ecox : Copy EcoX systemd service file] ***********************************
2021-04-30 15:28:03,174 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:03,177 p=23860 u=root n=ansible | TASK [ecox : Enable EcoX systemd] **********************************************
2021-04-30 15:28:03,737 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:03,741 p=23860 u=root n=ansible | TASK [ecox : Copy pgbouncer pkg] ***********************************************
2021-04-30 15:28:04,666 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:04,670 p=23860 u=root n=ansible | TASK [ecox : Install pgbouncer pkg] ********************************************
2021-04-30 15:28:05,085 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:05,089 p=23860 u=root n=ansible | TASK [ecox : Check necessary variables exists] *********************************
2021-04-30 15:28:05,109 p=23860 u=root n=ansible | ok: [172.21.0.16] => {
    "changed": false, 
    "msg": "All assertions passed"
}
2021-04-30 15:28:05,114 p=23860 u=root n=ansible | TASK [ecox : Fetch variables via pg_cluster] ***********************************
2021-04-30 15:28:05,178 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:05,181 p=23860 u=root n=ansible | TASK [ecox : Set cluster basic facts for hosts] ********************************
2021-04-30 15:28:05,234 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:05,240 p=23860 u=root n=ansible | TASK [ecox : Assert cluster primary singleton] *********************************
2021-04-30 15:28:05,258 p=23860 u=root n=ansible | ok: [172.21.0.16] => {
    "changed": false, 
    "msg": "All assertions passed"
}
2021-04-30 15:28:05,261 p=23860 u=root n=ansible | TASK [ecox : Setup cluster primary ip address] *********************************
2021-04-30 15:28:05,274 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:05,278 p=23860 u=root n=ansible | TASK [ecox : Setup repl upstream for primary] **********************************
2021-04-30 15:28:05,291 p=23860 u=root n=ansible | skipping: [172.21.0.16]
2021-04-30 15:28:05,294 p=23860 u=root n=ansible | TASK [ecox : Setup repl upstream for replicas] *********************************
2021-04-30 15:28:05,306 p=23860 u=root n=ansible | skipping: [172.21.0.16]
2021-04-30 15:28:05,310 p=23860 u=root n=ansible | TASK [ecox : Debug print instance summary] *************************************
2021-04-30 15:28:05,327 p=23860 u=root n=ansible | ok: [172.21.0.16] => {
    "msg": "cluster=pg-test2 service=pg-test2-primary instance=pg-test2-1 replication=[primary:itself]->172.21.0.16"
}
2021-04-30 15:28:05,331 p=23860 u=root n=ansible | TASK [ecox : Build zk cluster url] *********************************************
2021-04-30 15:28:05,349 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:05,354 p=23860 u=root n=ansible | TASK [ecox : Build zkhost] *****************************************************
2021-04-30 15:28:05,369 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:05,372 p=23860 u=root n=ansible | TASK [ecox : Check for existing postgres instance] *****************************
2021-04-30 15:28:05,765 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:05,769 p=23860 u=root n=ansible | TASK [ecox : Set fact whether pg port is open] *********************************
2021-04-30 15:28:05,784 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:05,788 p=23860 u=root n=ansible | TASK [ecox : Abort due to existing postgres instance] **************************
2021-04-30 15:28:05,801 p=23860 u=root n=ansible | skipping: [172.21.0.16]
2021-04-30 15:28:05,814 p=23860 u=root n=ansible | TASK [ecox : Clean existing postgres instance] *********************************
2021-04-30 15:28:05,828 p=23860 u=root n=ansible | skipping: [172.21.0.16]
2021-04-30 15:28:05,831 p=23860 u=root n=ansible | TASK [ecox : Shutdown existing postgres service] *******************************
2021-04-30 15:28:06,249 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:06,252 p=23860 u=root n=ansible | TASK [ecox : Remove registerd zookeeper service] *******************************
2021-04-30 15:28:06,642 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:06,645 p=23860 u=root n=ansible | TASK [ecox : Remove existing postgres data] ************************************
2021-04-30 15:28:07,040 p=23860 u=root n=ansible | changed: [172.21.0.16] => (item=/pg)
2021-04-30 15:28:07,043 p=23860 u=root n=ansible | TASK [ecox : Make sure main and backup dir exists] *****************************
2021-04-30 15:28:07,445 p=23860 u=root n=ansible | ok: [172.21.0.16] => (item=/export)
2021-04-30 15:28:07,449 p=23860 u=root n=ansible | TASK [ecox : Create postgres directory structure] ******************************
2021-04-30 15:28:07,859 p=23860 u=root n=ansible | ok: [172.21.0.16] => (item=/export/postgres/pg-test2-13)
2021-04-30 15:28:08,248 p=23860 u=root n=ansible | ok: [172.21.0.16] => (item=/export/postgres/pg-test2-13/bin)
2021-04-30 15:28:08,628 p=23860 u=root n=ansible | ok: [172.21.0.16] => (item=/export/postgres/pg-test2-13/tmp)
2021-04-30 15:28:09,038 p=23860 u=root n=ansible | changed: [172.21.0.16] => (item=/var/run/postgresql)
2021-04-30 15:28:09,043 p=23860 u=root n=ansible | TASK [ecox : Create links from current cluster] ********************************
2021-04-30 15:28:09,444 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:09,447 p=23860 u=root n=ansible | TASK [ecox : Check if postgres data folder exists] *****************************
2021-04-30 15:28:09,984 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:09,987 p=23860 u=root n=ansible | TASK [ecox : Abort due to pgdata is exists] ************************************
2021-04-30 15:28:10,001 p=23860 u=root n=ansible | skipping: [172.21.0.16]
2021-04-30 15:28:10,004 p=23860 u=root n=ansible | TASK [ecox : Clean pgdata] *****************************************************
2021-04-30 15:28:10,433 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:10,438 p=23860 u=root n=ansible | TASK [ecox : Make sure data dir exists] ****************************************
2021-04-30 15:28:10,828 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:10,832 p=23860 u=root n=ansible | TASK [ecox : Copy postgres scripts to /pg/bin/] ********************************
2021-04-30 15:28:12,545 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:12,548 p=23860 u=root n=ansible | TASK [ecox : Get config parameter page count] **********************************
2021-04-30 15:28:12,941 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:12,944 p=23860 u=root n=ansible | TASK [ecox : Get config parameter page size] ***********************************
2021-04-30 15:28:13,347 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:13,351 p=23860 u=root n=ansible | TASK [ecox : Tune shared buffer and work mem] **********************************
2021-04-30 15:28:13,373 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:13,376 p=23860 u=root n=ansible | TASK [ecox : Hanlde small size mem occasion] ***********************************
2021-04-30 15:28:13,394 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:13,398 p=23860 u=root n=ansible | TASK [ecox : Calculate postgres mem params] ************************************
2021-04-30 15:28:13,414 p=23860 u=root n=ansible | skipping: [172.21.0.16]
2021-04-30 15:28:13,417 p=23860 u=root n=ansible | TASK [ecox : Init postgres data] ***********************************************
2021-04-30 15:28:14,944 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:14,947 p=23860 u=root n=ansible | TASK [ecox : Replace tuned postgres.conf] **************************************
2021-04-30 15:28:15,880 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:15,883 p=23860 u=root n=ansible | TASK [ecox : Render hba rules] *************************************************
2021-04-30 15:28:16,672 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:16,677 p=23860 u=root n=ansible | TASK [ecox : Generate ecox.conf] ***********************************************
2021-04-30 15:28:17,486 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:17,490 p=23860 u=root n=ansible | TASK [ecox : Start PostgreSQL] *************************************************
2021-04-30 15:28:19,124 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:19,127 p=23860 u=root n=ansible | TASK [ecox : Wait for postgres primary online] *********************************
2021-04-30 15:28:19,667 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:19,670 p=23860 u=root n=ansible | TASK [ecox : Render init roles sql] ********************************************
2021-04-30 15:28:20,501 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:20,504 p=23860 u=root n=ansible | TASK [ecox : Render init template sql] *****************************************
2021-04-30 15:28:21,220 p=23860 u=root n=ansible | ok: [172.21.0.16]
2021-04-30 15:28:21,223 p=23860 u=root n=ansible | TASK [ecox : Render default pg-init scripts] ***********************************
2021-04-30 15:28:22,006 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:22,009 p=23860 u=root n=ansible | TASK [ecox : Execute initialization scripts] ***********************************
2021-04-30 15:28:22,908 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:22,911 p=23860 u=root n=ansible | TASK [ecox : Stop primary] *****************************************************
2021-04-30 15:28:23,533 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:23,537 p=23860 u=root n=ansible | TASK [ecox : Launch EcoX on primary instance] **********************************
2021-04-30 15:28:24,058 p=23860 u=root n=ansible | changed: [172.21.0.16]
2021-04-30 15:28:24,061 p=23860 u=root n=ansible | TASK [ecox : Wait for postgres primary online] *********************************
2021-04-30 15:28:54,489 p=23860 u=root n=ansible | fatal: [172.21.0.16]: FAILED! => {"changed": false, "elapsed": 30, "msg": "Timeout when waiting for 172.21.0.16:5432"}
2021-04-30 15:28:54,490 p=23860 u=root n=ansible | NO MORE HOSTS LEFT *************************************************************
2021-04-30 15:28:54,491 p=23860 u=root n=ansible | PLAY RECAP *********************************************************************
2021-04-30 15:28:54,491 p=23860 u=root n=ansible | 172.21.0.16                : ok=52   changed=23   unreachable=0    failed=1    skipped=6    rescued=0    ignored=0   
